{
  "hash": "a31aac39ffd64e094b68d8cffaa7288f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home Exercise 01\"\nauthor: \"Chun-Han\"\ndate: \"February 2, 2026\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n## Overview\n\nThis report analyzes income inequality among rural informal labourers in Northern Vietnam. Leveraging tidyverse for data wrangling and ggplot2 for visual analytics, we address key socio-economic questions through four progressive lenses:\n\n1.  **Macro Context**: Demographics and income distribution patterns.\n\n2.  **Structural Gaps**: The influence of ethnicity, gender, and livelihood diversity.\n\n3.  **Micro Influencers**: Returns on education, vocational training, and credit access.\n\n4.  **Social Outlook**: Linking policy priorities to rural development perceptions.\n\n## 1 Getting Started\n\n### 1.1 Installing and loading the packages\n\n| Library | Description |\n|-------------|-----------------------------------------------------------|\n| tidyverse | A collection of core packages designed for data science, used extensively for data preparation and wrangling. |\n| readxl | Allows R to read Excel files (.xlsx). |\n| patchwork | For arranging multiple ggplot2 figures into a composite figure. |\n| ggthemes | Provides extra themes, geoms, and scales for ggplot2. |\n| scales | Supplies scale functions and tools for customizing axes, labels, and legends in ggplot2. |\n| ggdist | An extension of ggplot2 for visualising distributions and uncertainty, useful for half-violin or raincloud plots. |\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, readxl, patchwork, ggthemes, scales, ggdist)\n```\n:::\n\n\n### 1.2 Data import\n\n[The dataset](https://www.sciencedirect.com/science/article/pii/S235234092100576X) used in this study is derived from a socio-economic survey of 725 informal labourers across five provinces in the Northern Mountainous Region of Vietnam. \nThe data consists of 725 observations and 30 variables, categorized into six key dimensions: Characteristics (C), Income Types (T), Impact Factors (F), Living Conditions (L), Policy Opinions (P), and Social Assessments (A).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_df <- read_excel(\"data/Upload for elsiver.xlsx\",\n                     sheet = 1,\n                     na = c(\"\", \"NA\"))\n```\n:::\n\n\n### 1.3 Filtering data for selected variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\nselected_df <- raw_df %>%\n  select(\n    CPRO, CGEN, CRAC, CJOB, CQUI,        \n    TEIN, TAIN, TSII, TOIN,              \n    FEDU, FVTP, FCRA, FTAP,              \n    LWDA,                                \n    starts_with(\"PPO\"),                  \n    ARO4,                                \n    starts_with(\"LHO\")                \n  )\n```\n:::\n\n\n### 1.4 Data Preprocessing\n\n#### 1.4.1 Checking Duplicate Rows \n\nUsing the `duplicated()` function to see whether there are duplicate entries in the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_dup <- raw_df[duplicated(raw_df), ]\nraw_dup\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 30\n   CPRO CGEN   CRAC  CJOB  CQUI  TEIN  TAIN  TSII  TOIN  FEDU  FVTP  FCRA  FTAP\n  <dbl> <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1     3 1         2     1     4    26    26     0     0     0     1     1     1\n2     5 1         1     1     5    18     7    11     0     0     1     1     1\n# ℹ 17 more variables: LHO1 <dbl>, LHO2 <dbl>, LHO3 <dbl>, LHO4 <dbl>,\n#   LCRE <dbl>, LSAV <dbl>, LWDA <dbl>, PPO1 <dbl>, PPO2 <dbl>, PPO3 <dbl>,\n#   PPO4 <dbl>, PPO5 <dbl>, ARO1 <dbl>, ARO2 <dbl>, ARO3 <dbl>, ARO4 <chr>,\n#   ARO5 <dbl>\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsel_dup <- selected_df[duplicated(selected_df), ]\nsel_dup\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 24\n   CPRO CGEN   CRAC  CJOB  CQUI  TEIN  TAIN  TSII  TOIN  FEDU  FVTP  FCRA  FTAP\n  <dbl> <chr> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1     3 1         2     1     5    24    24     0     0     0     1     1     1\n2     3 1         2     1     5    22    22     0     0     0     1     1     1\n3     3 1         2     1     5    22    22     0     0     0     1     1     1\n4     3 1         2     1     4    26    26     0     0     0     1     1     1\n5     5 1         1     1     5    18     7    11     0     0     1     1     1\n# ℹ 11 more variables: LWDA <dbl>, PPO1 <dbl>, PPO2 <dbl>, PPO3 <dbl>,\n#   PPO4 <dbl>, PPO5 <dbl>, ARO4 <chr>, LHO1 <dbl>, LHO2 <dbl>, LHO3 <dbl>,\n#   LHO4 <dbl>\n```\n\n\n:::\n:::\n\n\n:::callout-note\n**Interpretation of duplicates**\n\nWe checked duplicates at two levels:\n\n- `raw_df`: duplicates here indicate **exactly repeated records across all variables** (data-entry duplication).\n- `selected_df`: duplicates here may arise because, after selecting a subset of variables, **multiple respondents can share identical profiles** on the selected features (projection duplicates).\n\nSince this is a survey dataset **without respondent IDs**, and projection duplicates can legitimately reflect homogeneous socio-economic profiles in the target population, **we retain all records** to avoid artificially altering the sample distribution.\n:::\n\n#### 1.4.2 Checking Missing Value\n\n\n::: {.cell}\n\n```{.r .cell-code}\nna_summary <- selected_df %>%\n  summarise(across(everything(), ~sum(is.na(.)))) %>%\n  pivot_longer(everything(),\n               names_to = \"variable\",\n               values_to = \"na_count\") %>%\n  arrange(desc(na_count))\n\nna_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 24 × 2\n   variable na_count\n   <chr>       <int>\n 1 LHO4          653\n 2 LHO3          616\n 3 LHO1          512\n 4 LHO2          402\n 5 PPO2          230\n 6 PPO1          209\n 7 LWDA          160\n 8 ARO4          111\n 9 PPO5          106\n10 FTAP          102\n# ℹ 14 more rows\n```\n\n\n:::\n:::\n\n\n#### 1.4.3 Renaming Columns and Transforming Feature \n\nFor categorical grouping variables, missing values are retained as an explicit category (\"Unknown\") to preserve the full income distribution and avoid unnecessary sample loss.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclean_df <- selected_df %>%\n  \n  # 1) Listwise deletion on core income metric\n  filter(!is.na(TEIN)) %>%\n  \n  # 2) Rename columns first (more readable downstream)\n  rename(\n    total_income         = TEIN,\n    agri_income          = TAIN,\n    service_industry_inc = TSII,\n    other_income         = TOIN,\n    working_days         = LWDA,\n    policy_training      = PPO1,\n    policy_agri_chain    = PPO2,\n    policy_healthcare    = PPO3,\n    policy_elderly_care  = PPO4,\n    policy_urban_jobs    = PPO5,\n    wellbeing_improve    = ARO4,\n    house_cottage        = LHO1,\n    house_roofed         = LHO2,\n    house_solid          = LHO3,\n    house_buildings      = LHO4\n  ) %>%\n  \n  # 3) Binary indicators: NA -> 0\n  mutate(across(starts_with(\"house_\"),\n                ~replace_na(as.numeric(.), 0))) %>%\n  \n  # 4) PPO series: NA -> \"Not Answered\"\n  mutate(across(starts_with(\"policy_\"),\n                ~replace_na(as.character(.), \"Not Answered\"))) %>%\n  \n  # 5) Recode coded variables into factors (and explicitly keep missing as \"Unknown\")\n  mutate(\n    province = factor(CPRO, levels = 1:5,\n                      labels = c(\"Tuyen Quang\", \"Quang Ninh\", \"Ha Giang\", \"Yen Bai\", \"Bac Giang\")),\n    \n    gender = factor(CGEN, levels = c(1, 2),\n                    labels = c(\"Male\", \"Female\")) |> \n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    race = factor(CRAC, levels = c(1, 2),\n                  labels = c(\"Kinh\", \"Minority\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    job_type = factor(CJOB, levels = c(1, 2, 3),\n                      labels = c(\"Agricultural\", \"Service/Industrial\", \"Other\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    # Keep income group order from lowest -> top (useful for plots)\n    income_group = factor(CQUI, levels = c(5, 4, 3, 2, 1),\n                          labels = c(\"Lowest\", \"Second\", \"Middle\", \"Fourth\", \"Top\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    education = factor(FEDU, levels = c(0, 1, 2, 3),\n                       labels = c(\"Primary\", \"Lower secondary\", \"Upper secondary\", \"Other\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    training_status = factor(FVTP, levels = c(1, 2),\n                             labels = c(\"Short course\", \"Long course\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    credit_status = factor(FCRA, levels = c(1, 2),\n                           labels = c(\"Inaccessible\", \"Accessible\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    tech_level = factor(FTAP, levels = c(1, 2),\n                        labels = c(\"Low\", \"Adequate\")) |>\n      forcats::fct_explicit_na(\"Unknown\"),\n    \n    # Convert binary house indicators to factor labels\n    across(starts_with(\"house_\"),\n           ~factor(.x, levels = c(0, 1), labels = c(\"No\", \"Yes\"))),\n    \n    # Recode wellbeing (ARO4) if it's numeric 1-5; otherwise keep Unknown\n    wellbeing_improve = replace_na(as.character(wellbeing_improve), \"Unknown\"),\n    wellbeing_improve = case_when(\n      wellbeing_improve == \"1\" ~ \"Strongly Disagree\",\n      wellbeing_improve == \"2\" ~ \"Disagree\",\n      wellbeing_improve == \"3\" ~ \"Neutral\",\n      wellbeing_improve == \"4\" ~ \"Agree\",\n      wellbeing_improve == \"5\" ~ \"Strongly Agree\",\n      TRUE ~ \"Unknown\"\n    ) %>% factor(levels = c(\"Strongly Disagree\",\"Disagree\",\"Neutral\",\"Agree\",\"Strongly Agree\",\"Unknown\")),\n    \n    # PPO recode (keep Not Answered)\n    across(starts_with(\"policy_\"), ~case_when(\n      .x == \"1\" ~ \"Strongly Disagree\",\n      .x == \"2\" ~ \"Disagree\",\n      .x == \"3\" ~ \"Neutral\",\n      .x == \"4\" ~ \"Agree\",\n      .x == \"5\" ~ \"Strongly Agree\",\n      .x == \"Not Answered\" ~ \"Not Answered\",\n      TRUE ~ \"Not Answered\"\n    ) %>% factor(levels = c(\"Strongly Disagree\",\"Disagree\",\"Neutral\",\"Agree\",\"Strongly Agree\",\"Not Answered\"))),\n    \n    # Feature engineering\n    daily_wage = if_else(!is.na(working_days) & working_days > 0,\n                         total_income / working_days,\n                         NA_real_),\n    \n    agri_inc_ratio = if_else(total_income > 0, agri_income / total_income, NA_real_),\n    service_inc_ratio = if_else(total_income > 0, service_industry_inc / total_income, NA_real_),\n    other_inc_ratio = if_else(total_income > 0, other_income / total_income, NA_real_)\n  ) %>%\n  \n  # Drop original coded columns (optional but keeps dataset clean)\n  select(-CPRO, -CGEN, -CRAC, -CJOB, -CQUI, -FEDU, -FVTP, -FCRA, -FTAP)\n\n# Final verification\nglimpse(clean_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 724\nColumns: 28\n$ total_income         <dbl> 37, 25, 33, 35, 36, 21, 35, 36, 38, 30, 58, 24, 3…\n$ agri_income          <dbl> 25, 22, 25, 30, 28, 17, 25, 28, 26, 22, 40, 24, 2…\n$ service_industry_inc <dbl> 7, 0, 0, 5, 0, 0, 0, 0, 12, 2, 0, 0, 0, 0, 0, 50,…\n$ other_income         <dbl> 5, 3, 8, 0, 8, 4, 10, 8, 0, 6, 18, 0, 9, 0, 2, 15…\n$ working_days         <dbl> 240, 350, 260, 300, 360, 360, 260, 260, 300, 300,…\n$ policy_training      <fct> Strongly Agree, Disagree, Strongly Agree, Not Ans…\n$ policy_agri_chain    <fct> Disagree, Strongly Agree, Strongly Agree, Not Ans…\n$ policy_healthcare    <fct> Neutral, Neutral, Strongly Disagree, Not Answered…\n$ policy_elderly_care  <fct> Strongly Disagree, Strongly Disagree, Strongly Di…\n$ policy_urban_jobs    <fct> Neutral, Strongly Disagree, Strongly Disagree, No…\n$ wellbeing_improve    <fct> Neutral, Neutral, Unknown, Unknown, Disagree, Dis…\n$ house_cottage        <fct> No, Yes, No, Yes, No, No, No, No, No, No, No, No,…\n$ house_roofed         <fct> Yes, No, No, No, Yes, Yes, No, Yes, Yes, Yes, Yes…\n$ house_solid          <fct> No, No, No, No, No, No, Yes, No, No, No, No, No, …\n$ house_buildings      <fct> No, No, Yes, No, No, No, No, No, No, No, No, No, …\n$ province             <fct> Tuyen Quang, Tuyen Quang, Tuyen Quang, Tuyen Quan…\n$ gender               <fct> Male, Male, Female, Male, Female, Female, Male, M…\n$ race                 <fct> Minority, Minority, Minority, Minority, Minority,…\n$ job_type             <fct> Agricultural, Agricultural, Other, Agricultural, …\n$ income_group         <fct> Middle, Lowest, Middle, Middle, Middle, Second, T…\n$ education            <fct> Lower secondary, Primary, Lower secondary, Lower …\n$ training_status      <fct> Short course, Short course, Short course, Short c…\n$ credit_status        <fct> Inaccessible, Accessible, Inaccessible, Inaccessi…\n$ tech_level           <fct> Low, Low, Adequate, Unknown, Adequate, Adequate, …\n$ daily_wage           <dbl> 0.15416667, 0.07142857, 0.12692308, 0.11666667, 0…\n$ agri_inc_ratio       <dbl> 0.6756757, 0.8800000, 0.7575758, 0.8571429, 0.777…\n$ service_inc_ratio    <dbl> 0.18918919, 0.00000000, 0.00000000, 0.14285714, 0…\n$ other_inc_ratio      <dbl> 0.13513514, 0.12000000, 0.24242424, 0.00000000, 0…\n```\n\n\n:::\n:::\n\n\nFor Likert-scale items (PPO and ARO4), missing responses are treated as non-substantive answers.  \nWe label PPO missing values as **\"Not Answered\"** to distinguish non-response from agreement levels, and recode ARO4 into ordered agreement categories while keeping missing/invalid entries as **\"Unknown\"**.\n\n## 2 Visualization\n\n### 2.1 \n\n::: panel-tabset\n### Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](TE01_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_data_21 <- clean_df %>%\n  count(province, race, gender, name = \"count\") %>%\n  group_by(province) %>%\n  mutate(\n    prov_total = sum(count),\n    percentage = count / prov_total,\n    facet_label = paste0(province, \" \\n(N=\", prov_total, \")\")\n  ) %>%\n  ungroup()\n\nggplot(plot_data_21, aes(x = race, y = percentage, fill = gender)) +\n  geom_col(width = 0.7, alpha = 0.9) +\n  geom_text(\n    aes(label = scales::percent(percentage, accuracy = 1)),\n    position = position_stack(vjust = 0.5),\n    size = 3,\n    color = \"white\"\n  ) +\n  facet_wrap(~facet_label, nrow = 1) +\n  scale_y_continuous(\n    labels = scales::percent_format(accuracy = 1),\n    expand = expansion(mult = c(0, 0.05))\n  ) +\n  scale_fill_manual(\n    values = c(\"Male\" = \"#547d9d\", \"Female\" = \"#d8a437\")\n  ) +\n  labs(\n    title = \"Workforce Composition by Region\",\n    subtitle = \"Proportional share within each province\",\n    x = \"Ethnic Group\",\n    y = \"Share of Province\",\n    fill = \"Gender\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    legend.position = \"top\",\n    strip.text = element_text(size = 11, face = \"bold\"),\n    axis.text = element_text(size = 10),\n    panel.spacing = unit(1.2, \"lines\")\n  )\n```\n:::\n\n:::\n\n**Observation**\n\nThis visualization confirms a balanced sampling design across the five provinces, with each region contributing a comparable number of observations. Clear regional differences emerge in ethnic composition: ethnic minorities dominate the informal labour force in Ha Giang, Tuyen Quang, and Yen Bai, whereas Kinh workers represent a larger share in Bac Giang and Quang Ninh. This highlights the strong association between remoteness and minority participation in informal employment.\n\nIn contrast, gender composition exhibits a consistent structural imbalance rather than a geographic pattern. Male workers account for the majority of informal labourers across all provinces and ethnic groups, with only modest variation in female participation. These differences occur within an overall male-dominated workforce and do not show systematic spatial variation. This suggests that gender disparities in informal labour participation reflect broader labour market or household-level constraints, while regional variation is more strongly driven by ethnicity and location.\n\n\n",
    "supporting": [
      "TE01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}